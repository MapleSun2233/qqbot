# QQ机器人批量发送工具

基于LLOneBot WebSocket API的QQ机器人批量消息发送管理工具。

## 功能特性

- ✅ **WebSocket连接管理** - 自动连接、重连机制
- ✅ **群组和好友管理** - 获取并展示群列表和好友分组
- ✅ **批量选择** - 支持批量选择发送对象
- ✅ **富媒体消息** - 支持文字+图片+视频+文件的混合消息
- ✅ **发送进度跟踪** - 实时显示发送进度和状态
- ✅ **失败重试** - 自动重试失败的消息发送
- ✅ **友好界面** - 现代化的用户界面设计
- 🆕 **多条消息支持** - 可以设置多条消息，按顺序发送给所有选中对象
- 🆕 **消息间隔控制** - 每条消息发送完成后可设置等待时间再发送下一条

## 技术栈

- **前端框架**: React 18 + Vite
- **UI组件库**: Ant Design
- **WebSocket**: 原生WebSocket API
- **状态管理**: React Hooks

## 安装和运行

### 前置要求

1. Node.js 16+
2. LLOneBot 已安装并配置
3. LLOneBot WebSocket服务运行在 `ws://127.0.0.1:3001`

### 安装依赖

```bash
npm install
```

### 启动开发服务器

```bash
npm run dev
```

应用将在 `http://localhost:5174` 启动

### 构建生产版本

```bash
npm run build
```

## 使用说明

### 1. 连接WebSocket服务

- 应用启动后会自动尝试连接到 `ws://127.0.0.1:3001`
- 连接状态显示在页面右上角
- 连接失败会自动重试，最多重试5次

### 2. 选择发送对象

- 左侧面板显示群组和好友列表
- 支持搜索功能快速查找
- **可以同时选择群组和好友**进行批量发送
- 实时显示已选择的群组和好友数量
- 支持全选/取消全选操作

### 3. 编辑消息内容

#### 单条消息模式（兼容旧版本）
- 在消息编辑器中输入文字内容
- 可以上传多张图片、视频和文件作为附件
- 支持实时预览消息内容和附件

#### 多条消息模式（新功能）
- **消息间隔设置**：在顶部设置每条消息发送完成后的等待时间（1-60秒）
- **添加多条消息**：点击"添加消息"按钮创建新的消息
- **消息管理**：
  - 使用标签页切换不同消息的编辑
  - 每条消息可以独立设置文字、图片、视频和文件
  - 支持复制消息内容到新消息
  - 支持删除不需要的消息（至少保留一条）
- **发送顺序**：消息按从左到右的标签页顺序发送
- **发送逻辑**：
  1. 先发送第1条消息给所有选中的联系人
  2. 等待设定的消息间隔时间
  3. 再发送第2条消息给所有选中的联系人
  4. 重复直到所有消息发送完成

#### 消息预览
- 图片预览支持缩略图显示（最多显示6张，超出显示数量）
- 文字和图片混合预览，模拟真实QQ消息效果
- 每条消息独立预览，方便确认内容

### 4. 设置发送延时

- 在发送控制区域设置延时范围（默认1-3秒）
- 支持0.1-10秒的精确设置
- 自动验证最小值不大于最大值
- 实时显示当前延时设置

### 5. 批量发送

#### 发送流程
- 点击"开始发送"按钮开始批量发送
- **多消息发送顺序**：
  1. 第1条消息 → 联系人A → 联系人B → 联系人C → ... → 等待间隔时间
  2. 第2条消息 → 联系人A → 联系人B → 联系人C → ... → 等待间隔时间
  3. 重复直到所有消息发送完成

#### 进度监控
- 实时显示发送进度和统计信息
- 总进度 = 联系人数量 × 消息数量
- 显示当前正在发送的消息编号
- 发送过程中可以随时停止
- 失败的消息会自动收集，支持重试

### 6. 处理发送结果

- 发送完成后显示成功/失败统计
- 失败的消息可以查看详细错误信息
- 支持重试失败的消息发送

## API配置

默认WebSocket地址为 `ws://127.0.0.1:3001`，如需修改请编辑：

```javascript
// src/utils/websocket.js
this.url = 'ws://127.0.0.1:3001'; // 修改为你的WebSocket地址
```

## 支持的消息类型

- 纯文本消息
- 图片消息（支持多张，最大10MB/张）
- 视频消息（最大100MB/个）
- 文件上传（最大50MB/个）
- 混合消息（文字+图片+视频+文件）

## 文件处理机制

### Base64编码传输
- 自动将上传的文件转换为Base64格式
- 示例：`base64://iVBORw0KGgoAAAANSUhEUgAA...`
- 优势：可靠性高，无需依赖文件系统，跨平台兼容

### 为什么不使用file://协议？
详见 `WHY_BASE64.md` 文档，主要原因：
- 浏览器安全限制无法获取真实文件路径
- Base64方案提供更好的兼容性和用户体验

## 注意事项

1. **发送频率限制**: 为避免被腾讯限制，每条消息之间有可配置的随机延迟（默认1-3秒）
2. **文件大小限制**:
   - 图片：最大10MB/张
   - 视频：最大100MB/个
   - 文件：最大50MB/个
3. **连接稳定性**: 确保LLOneBot服务稳定运行
4. **权限要求**: 确保机器人有发送消息和上传文件的权限

## 开发

### 项目结构

```
src/
├── api/           # API接口封装
├── components/    # React组件
├── utils/         # 工具函数
├── App.jsx        # 主应用组件
└── main.jsx       # 应用入口
```

### 主要组件

- `ConnectionStatus` - 连接状态显示
- `ContactSelector` - 联系人选择器
- `MessageEditor` - 消息编辑器
- `SendProgress` - 发送进度控制

